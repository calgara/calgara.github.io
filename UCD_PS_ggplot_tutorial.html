<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Carlos Algara, Cory Struthers (Belden), &amp; Jaime Jackson" />


<title>Programming &amp; Methods Resources Workshop</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Carlos Algara</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="cv.html">CV</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Research
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="media.html">Media Appearances</a>
    </li>
    <li>
      <a href="working_papers.html">Publications</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Teaching
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="teaching.html">Teaching Portfolio</a>
    </li>
    <li>
      <a href="pol5310s2021.html">POL 5310 (UTEP), Spring 2021</a>
    </li>
    <li>
      <a href="pol157s2019.html">POL 157 (Sac State), Spring 2019</a>
    </li>
    <li>
      <a href="pol1f2017.html">POL 1 (UCD), Fall 2017</a>
    </li>
    <li>
      <a href="pol1s2017.html">POL 1 (UCD), Summer 2017</a>
    </li>
    <li>
      <a href="UCD_PS_ggplot_tutorial.html">ggplot Data Visualization Tutorial</a>
    </li>
  </ul>
</li>
<li>
  <a href="about.html">About Me</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="mailto:caalgara@utep.edu">
    <span class="fa fa-envelope fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="http://github.com/calgara">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/algaraca">
    <span class="fa fa-twitter fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://scholar.google.com/citations?user=AJASqUMAAAAJ&amp;hl=en&amp;oi=ao">
    <span class="fa fa-graduation-cap fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Programming &amp; Methods Resources Workshop</h1>
<h3 class="subtitle">Introduction to The Grammar of Graphics (<tt>ggplot</tt>) &amp; Data Visualization</h3>
<h4 class="author"><a href="mailto:calgara@ucdavis.edu">Carlos Algara</a>, <a href="mailto:rbelden@ucdavis.edu">Cory Struthers (Belden)</a>, &amp; <a href="mailto:jajack@ucdavis.edu">Jaime Jackson</a></h4>
<h4 class="date">5/25/2018</h4>

</div>


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-100362112-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-100362112-1');
</script>
<p><br/></p>
<p>To replicate the following tutorial, you can find the replication code &amp; data here: <strong><em><a href="UCD_PS_ggplot_workshop_replication_code.R">R script</a></em></strong> &amp; <strong><em><a href="ggplot_tutorial.Rdata">Tutorial Data in R Environment form</a></em></strong>.</p>
<div id="general-overview-of-ggplot-tutorial" class="section level2">
<h2><em>General Overview of <tt>ggplot</tt> Tutorial</em></h2>
<p>The basic logic (&amp; relative advantages) behind the ggplot coding interface can be summarized in the following key points:</p>
<ul>
<li><p>Consistent langugage underlies the code, commonly referred to as the ``grammar of graphics’’ (Wilkinson 2005)</p></li>
<li><p>Very flexible programming which can, with few changes, be used to create multiple types of data visualization. For example, it takes one simple section of code to change a bar chart to a line graph.</p></li>
<li><p>Many themes are available to polish and cutomize your high resolution plots.</p></li>
<li><p>Most importantly, for our purposes, <tt>ggplot</tt> code is fully intergrated in the <tt>R</tt> computing environment. What this means is that we can derive multiple quantities of interest (descriptive statistics, model output, post-estimated model quantities of interest, etc.) using various packages and plot them using <tt>ggplot</tt></p></li>
<li><p><strong><em>HUGE</em></strong>, I’m talking HUGE, user community dedicated to providing crowd sourced code for whatever cutomization you seek in the <tt>ggplot</tt> environment.</p></li>
</ul>
<p>In this tutorial, I will provide an applied tutorial to understanding the logic of the <tt>ggplot</tt> language while completing the following tasks:</p>
<ol style="list-style-type: decimal">
<li><p>Plotting descriptive distributions of key variables (histograms, density plots, bar charts, dot plots)</p></li>
<li><p>Plotting simple bivariate relationships of interest with appropriate measures of uncertainty around estimates (scatterplots, difference of means bar charts, boxplots)</p></li>
<li><p>Plotting model quantities of interests that provide for a graphical interpretation of our empirical work rather than tables. We will make coefficient plots articulating model output, plots articulating interactive relationships of interest, and post-estimation plots of interest (predicted probabilities from a logistic regerssion, marginal effects plots).</p></li>
<li><p>Basic preview to graphic add-ons to <tt>ggplot</tt> which provides for spatial mapping and plotting of social networks. <br/> <br/></p></li>
</ol>
</div>
<div id="plotting-descriptives" class="section level2">
<h2><em>Plotting Descriptives</em></h2>
<p>For this example, let’s tackle a problem plaguing the nature of ideological representation and congruence between the mass public and their elected elites (see <a href="http://www.jstor.org/stable/2110458?seq=1#page_scan_tab_contents">Achen’s (1978)</a> critique of the infamous <a href="http://www.jstor.org/stable/1952717?seq=1#page_scan_tab_contents">Miller &amp; Stokes (1963)</a> study as a primer on the methodological problem). Let’s start by loading, exploring the data, and walking through some examples of plotting describtive data.</p>
<pre class="r"><code>library(ggplot2) # Load ggplot2
library(plyr) # Loaad plyr, which provides tools for summarizing data
library(readstata13) # Load readstata13 to read Stata Files
library(dplyr) # Loaad dplyr, which provides tools that I always use, like as_tibble
library(reshape) # Load reshape, which provides for the melt function needed for data manipulation.

load(&quot;/Users/caalgara/Desktop/carlos_school/PhD_UC Davis/Dissertation Project/Ch2_Electoral_Implications_Approval/Aldrich_McKelvey_Scaling/Aldrich_McKelvey_Scaling_2008_2016_Positions_Results.Rdata&quot;) # Load R environment containing various estimations of candidate &amp; citizen ideological ideal points from 2008-2016.

# Let&#39;s explore the nature of ideological preferences in the American electorate over time!

print(as_tibble(rescaled_overtime_idealpts_2008_2016))</code></pre>
<pre><code>## # A tibble: 262,896 x 10
##    year  case_id year_district_id intercept aldmck_weight_p… idealpt selfplace
##    &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;                &lt;dbl&gt;            &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
##  1 2008  112     2008 NY14           -0.653            0.218   0.218         4
##  2 2008  11212   2008 CA23           -2.18             0.435  -1.31          2
##  3 2008  11488   2008 WA8            -0.943            0.354   1.18          6
##  4 2008  11710   2008 MA2            -0.843            0.281   0.562         5
##  5 2008  11902   2008 IL10           -3.05             0.653  -0.435         4
##  6 2008  12118   2008 MI15           -1.41             0.326  -1.09          1
##  7 2008  12517   2008 CA43           -0.957            0.261  -0.696         1
##  8 2008  127     2008 NY22           -1.32             0.331  -0.994         1
##  9 2008  1300    2008 CA7            -1.09             0.326  -0.435         2
## 10 2008  13717   2008 NC4            -1.09             0.653   2.83          6
## # … with 262,886 more rows, and 3 more variables: polinfo &lt;dbl&gt;,
## #   idealpts_linear_map_overtime &lt;dbl&gt;, pid7 &lt;chr&gt;</code></pre>
<pre class="r"><code># Huge data frame of scaled Aldrich-McKelvey ideal points for each CCES respondent from 2008-2016. For more information on the method deriving these scaled ideal points, see Ramey (2016).

# Of course, countless studies suggest that the distribution of ideological preferences of the mass public is unimodal. Let&#39;s make a density plot to see if this is the case.

ggplot(data=rescaled_overtime_idealpts_2008_2016,aes(x=idealpt))</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/r-1.png" width="672" /></p>
<pre class="r"><code># Not so fast my dude. We have to learn to crawl before we run, what happened?

# Now that we have some knowledge and have to specify our density plot aestic, let&#39;s get to work &amp; make our plot!

ggplot(data=rescaled_overtime_idealpts_2008_2016,aes(x=idealpt)) + geom_density()</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/r-2.png" width="672" /></p>
<pre class="r"><code># Success! But there might be evidence that the distribution of ideological preferences might be trimodal. That is, clear partisan cleavages with respect to ideological preferences. Let&#39;s explore this possibility by first coding partisan preferences

rescaled_overtime_idealpts_2008_2016$pid3 &lt;- ifelse(rescaled_overtime_idealpts_2008_2016$pid7 %in% c(&quot;Lean Republican&quot;,&quot;Not very strong Republican&quot;,&quot;Strong Republican&quot;),&quot;Republican&quot;,ifelse(rescaled_overtime_idealpts_2008_2016$pid7 %in% c(&quot;Lean Democrat&quot;,&quot;Not very strong Democrat&quot;,&quot;Strong Democrat&quot;),&quot;Democrat&quot;,ifelse(rescaled_overtime_idealpts_2008_2016$pid7 %in% c(&quot;Independent&quot;),&quot;Independent&quot;,NA)))

print(as_tibble(rescaled_overtime_idealpts_2008_2016)) # Let&#39;s check it out</code></pre>
<pre><code>## # A tibble: 262,896 x 11
##    year  case_id year_district_id intercept aldmck_weight_p… idealpt selfplace
##    &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;                &lt;dbl&gt;            &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
##  1 2008  112     2008 NY14           -0.653            0.218   0.218         4
##  2 2008  11212   2008 CA23           -2.18             0.435  -1.31          2
##  3 2008  11488   2008 WA8            -0.943            0.354   1.18          6
##  4 2008  11710   2008 MA2            -0.843            0.281   0.562         5
##  5 2008  11902   2008 IL10           -3.05             0.653  -0.435         4
##  6 2008  12118   2008 MI15           -1.41             0.326  -1.09          1
##  7 2008  12517   2008 CA43           -0.957            0.261  -0.696         1
##  8 2008  127     2008 NY22           -1.32             0.331  -0.994         1
##  9 2008  1300    2008 CA7            -1.09             0.326  -0.435         2
## 10 2008  13717   2008 NC4            -1.09             0.653   2.83          6
## # … with 262,886 more rows, and 4 more variables: polinfo &lt;dbl&gt;,
## #   idealpts_linear_map_overtime &lt;dbl&gt;, pid7 &lt;chr&gt;, pid3 &lt;chr&gt;</code></pre>
<pre class="r"><code>ggplot(data=rescaled_overtime_idealpts_2008_2016,aes(x=idealpt,color=pid3)) + geom_density()</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/r-3.png" width="672" /></p>
<pre class="r"><code># Urgh, good start but pretty ugly and nowhere close to publication quality. Let&#39;s make this prettier by factoring out our pid3 and getting rid of &quot;NA&quot;.

rescaled_overtime_idealpts_2008_2016$pid3 &lt;- factor(rescaled_overtime_idealpts_2008_2016$pid3,levels=c(&quot;Democrat&quot;,&quot;Independent&quot;,&quot;Republican&quot;))

print(str(rescaled_overtime_idealpts_2008_2016$pid3))</code></pre>
<pre><code>##  Factor w/ 3 levels &quot;Democrat&quot;,&quot;Independent&quot;,..: 2 1 3 2 1 1 1 1 1 3 ...
## NULL</code></pre>
<pre class="r"><code># Let&#39;s make a really pretty plot showing partisan differences.

ggplot(subset(rescaled_overtime_idealpts_2008_2016,rescaled_overtime_idealpts_2008_2016$pid3 != &quot;Independent&quot;),aes(x=idealpt,fill = pid3))+ geom_density(alpha=.2) + theme_bw() + scale_fill_manual(&quot;&quot;,values =c(&quot;blue&quot;,&quot;red&quot;)) + scale_x_continuous(&quot;Aldrich-McKelvey Ideological Placement (Liberal-Conservative)&quot;,breaks=c(-4,0,4),limits=c(-4,4),labels=c(&quot;-4&quot;,&quot;0&quot;,&quot;4&quot;)) + scale_y_continuous(&quot;Density&quot;,expand=c(0,0)) + theme(legend.position=c(0.10, 0.90), legend.box.just = &quot;left&quot;, legend.key.size = unit(1,&quot;line&quot;), legend.key = element_rect(size = 0, color = &#39;white&#39;), legend.text.align = 0, legend.box = &quot;horizontal&quot;) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/r-4.png" width="672" /></p>
<pre class="r"><code># This is cool, let&#39;s do House candidates! First, let&#39;s check the data frame.

print(as_tibble(aldmck_congress))</code></pre>
<pre><code>## # A tibble: 1,900 x 6
##    district placement.dem_p… placement.rep_p… placement.dem_h… placement.rep_h…
##    &lt;chr&gt;               &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1 AK1                -0.390            0.816         -0.287              0.832
##  2 AL5                -0.390            0.816         -0.115              1.01 
##  3 AL3                -0.390            0.816         -0.234              0.724
##  4 AL2                -0.390            0.816          0.0107             0.912
##  5 AL4                -0.390            0.816          0.0506             0.790
##  6 AZ1                -0.390            0.816         -0.00825            0.629
##  7 AZ2                -0.390            0.816          0.0454             0.727
##  8 AZ3                -0.390            0.816         -0.246              0.827
##  9 AZ4                -0.390            0.816         -0.132              0.461
## 10 AZ5                -0.390            0.816         -0.209              0.762
## # … with 1,890 more rows, and 1 more variable: year &lt;dbl&gt;</code></pre>
<pre class="r"><code># Oh no, we have to manipulate the dataframe. Urgh, bummer, but easy!

house_candidates &lt;- subset(aldmck_congress,select=c(&quot;year&quot;,&quot;district&quot;,&quot;placement.dem_hse_libcon_placement&quot;,&quot;placement.rep_hse_libcon_placement&quot;)) # Extract the variables you want

house_candidates &lt;- melt(house_candidates,id=c(&quot;year&quot;,&quot;district&quot;)) # Melt the dataframe from wide to long!

print(table(house_candidates$variable)) # We have one variable with a string variable indicating candidate type.</code></pre>
<pre><code>## 
## placement.dem_hse_libcon_placement placement.rep_hse_libcon_placement 
##                               1900                               1900</code></pre>
<pre class="r"><code>house_candidates$variable &lt;- ifelse(house_candidates$variable == &quot;placement.dem_hse_libcon_placement&quot;,&quot;Democrat&quot;,ifelse(house_candidates$variable == &quot;placement.rep_hse_libcon_placement&quot;,&quot;Republican&quot;,NA))

ggplot(house_candidates, aes(x = value, fill = variable,linetype=variable)) + geom_density(alpha=.2) + theme_minimal() + scale_fill_manual(&quot;&quot;,values =c(&quot;blue&quot;,&quot;red&quot;)) + scale_x_continuous(&quot;Candidate Aldrich-McKelvey Ideological Placement (Liberal-Conservative)&quot;,limits=c(-1,1),breaks=c(-1,0,1),labels=c(&quot;-1&quot;,&quot;0&quot;,&quot;1&quot;)) + scale_y_continuous(&quot;Density&quot;,expand=c(0,0)) + theme(legend.position=&quot;bottom&quot;, legend.box.just = &quot;left&quot;, legend.key.size = unit(1,&quot;line&quot;), legend.key = element_rect(size = 0, color = &#39;white&#39;), legend.text.align = 0, legend.box = &quot;horizontal&quot;) + scale_linetype_manual(&quot;&quot;,values=c(&quot;solid&quot;,&quot;dashed&quot;)) + facet_wrap(~year)</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/r-5.png" width="672" /></p>
<pre class="r"><code># What did we just do?

# We can also assess the validity of our ideal points by looking at the box plot distributions

ggplot(rescaled_overtime_idealpts_2008_2016, aes(x=selfplace, y=idealpts_linear_map_overtime, group=selfplace)) + geom_boxplot(colour = &quot;black&quot;,outlier.shape = NA) + scale_y_continuous(&quot;Liberal-Conservative Aldrich-McKelvey Ideal Point Estimates&quot;,limits=c(-2.5,2.5),breaks=seq(-2,2,1)) + scale_x_continuous(&quot;Liberal-Conservative Raw Ideological Self-Placement&quot;,breaks=seq(1,7,1)) + scale_fill_discrete(guide=F) + stat_summary(fun.y = mean, geom=&quot;point&quot;,colour=&quot;black&quot;, size=2.00, shape= 17) + scale_shape_discrete(&quot;&quot;) + theme_minimal()</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/r-6.png" width="672" /></p>
<p>We can also plot descriptives, such as line graphs articulating trends in time. Let’s load some data presidential approval from the great people at the <a href="www.ropercenter.com">Roper Center</a> and also make a histogram for initial evaluation of our approval data.</p>
<pre class="r"><code>approval &lt;- read.csv(&quot;/Users/caalgara/Desktop/carlos_school/PhD_UC Davis/Research/Data/American Politics/Presidential_Approval/presidents_survey_marginals_1969_2017.csv&quot;)

as_tibble(approval)</code></pre>
<pre><code>## # A tibble: 4,075 x 12
##        X Organization Polling.Start Polling.End Approve Disapprove No.Opinion
##    &lt;int&gt; &lt;chr&gt;        &lt;chr&gt;         &lt;chr&gt;         &lt;int&gt;      &lt;int&gt; &lt;chr&gt;     
##  1     1 Quinnipiac … 2017-01-20    2017-01-25       36         44 19        
##  2     2 TIPP / IBD   2017-01-27    2017-02-02       42         48 9         
##  3     3 CNN          2017-01-31    2017-02-02       44         53 3         
##  4     4 CBS News     2017-02-01    2017-02-02       40         48 12        
##  5     5 Quinnipiac … 2017-02-02    2017-02-06       42         51 7         
##  6     6 Pew          2017-02-07    2017-02-12       39         56 6         
##  7     7 Fox          2017-02-11    2017-02-13       48         47 6         
##  8     8 Kaiser Fami… 2017-02-13    2017-02-19       41         52 7         
##  9     9 McClatchy /… 2017-02-15    2017-02-19       41         49 9         
## 10    10 Quinnipiac … 2017-02-16    2017-02-21       38         55 7         
## # … with 4,065 more rows, and 5 more variables: Sample.Size &lt;int&gt;,
## #   president &lt;chr&gt;, year &lt;int&gt;, approval_measure &lt;dbl&gt;, series &lt;chr&gt;</code></pre>
<pre class="r"><code>ggplot(approval, aes(x = approval_measure)) + geom_histogram(alpha=.2,fill=&quot;black&quot;,color=&quot;black&quot;) + theme_minimal() + scale_x_continuous(&quot;Presidential Approval Polling&quot;) + ggtitle(&quot;Distribution of Presidential Approval Polling Data, 1969-2017&quot;) </code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>Let’s make a simple figure of presidential approval over time. Note, since we have data that is daily given the polling end date, we have to convert the date variable to something <span class="math inline">\(\texttt{ggplot}\)</span> can use.</p>
<pre class="r"><code>approval$Polling.End &lt;- as.Date(approval$Polling.End)
ggplot(approval,aes(x=Polling.End,y=approval_measure)) + geom_line()</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>This is a really noisy plot, given the number of polls we have (<span class="math inline">\(N\)</span> = 4,075). Perhaps we are interested in a single president. <span class="math inline">\(\texttt{ggplot}\)</span> provides for flexibility in subsetting data for our purposes. Consider the following simple line graph looking at the history of presidential approval during the presidency of George W. Bush.</p>
<pre class="r"><code>ggplot(subset(approval,approval$president == &quot;Bush&quot;),aes(x=Polling.End,y=approval_measure)) + geom_line() + ggtitle(&quot;Presidential Approval during the George W. Bush Administration, 2001-2009&quot;)</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Still a little noisy. What we could do is plot this using a series of boxplots by year to see how well George Bush’s approval rating held up over the years.</p>
<pre class="r"><code>approval$year_factor &lt;- factor(approval$year,levels=seq(1969,2017,1))
ggplot(subset(approval,approval$president == &quot;Bush&quot;),aes(x=year_factor,y=approval_measure)) + geom_boxplot() + ggtitle(&quot;Presidential Approval during the George W. Bush Administration, 2001-2009&quot;)</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Why don’t we take the mean for each year and fix our line graph? Let’s add labels too to make the plot pretty and distinguish between Presidents.</p>
<pre class="r"><code>mean_approval &lt;- ddply(approval, .(year), summarize,  approval_mean =mean(approval_measure, na.rm = T))

mean_approval$president &lt;- ifelse(mean_approval$year %in% 1969, &quot;Nixon&quot;,ifelse(mean_approval$year %in% 1974, &quot;Ford&quot;,ifelse(mean_approval$year %in% 1977, &quot;Carter&quot;,ifelse(mean_approval$year %in% 1981, &quot;Reagan&quot;,ifelse(mean_approval$year %in% 1989, &quot;Bush 43&quot;,ifelse(mean_approval$year %in% 1993, &quot;Clinton&quot;,ifelse(mean_approval$year %in% 2001, &quot;W. Bush&quot;,ifelse(mean_approval$year %in% 2009, &quot;Obama&quot;,ifelse(mean_approval$year %in% 2017, &quot;Trump&quot;,NA)))))))))

library(ggrepel) # Package the allows us to use label repels

ggplot(mean_approval,aes(x=year,y=approval_mean,label=president)) + geom_line() + theme_bw() + geom_label_repel(arrow = arrow(length = unit(0.02, &#39;npc&#39;)),segment.size = 0.5, box.padding = 0.5,point.padding = 1, size = 3.5) + ggtitle(&quot;Presidential Approval from Nixon to Trump, 1969-2017&quot;) + scale_x_continuous(&quot;&quot;,breaks=seq(1968,2016,4)) + scale_y_continuous(&quot;Yearly Presidential Approval Rating&quot;)</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="plotting-bivariate-relationships" class="section level2">
<h2><em>Plotting Bivariate Relationships</em></h2>
<p>While we implicitly plotted a bivariate relationship using the box-plot in the previous example, we can provide more explicit examples for studying bivariate relationships. Let’s use data on the 2016 U.S. House elections to look at the relationship between presidential voteshare and House election voteshare. Also, let’s fit a simple bivariate regression line to see in which districts Democratic candidates underperformed Clinton and which candidates over-performed Clinton. This will be articulated in the residual distance between the individual points and the point-estimate articulated in the regression line. In other words, the distance between the observed value <span class="math inline">\(Y\)</span> (in this case, the vote share won by the Democratic House candidate) and <span class="math inline">\(\hat{Y}\)</span> (in this case, the predicted vote share won by the Democratic House candidate articulated in the regression line).</p>
<pre class="r"><code>as_tibble(house)</code></pre>
<pre><code>## # A tibble: 25,367 x 15
##     year  stcd state cd    inc   pwin     dv   dvp fr    po1   po2   redist
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; 
##  1  1900   101 AL    1     Demo… Demo…  82.7  NA   &quot;&quot;    Amat… Noth… &quot;&quot;    
##  2  1900   102 AL    2     Demo… Demo…  98.3  83.3 &quot;&quot;    Only… Noth… &quot;&quot;    
##  3  1900   103 AL    3     Demo… Demo…  80.2  96.9 &quot;&quot;    Amat… Noth… &quot;&quot;    
##  4  1900   104 AL    4     Demo… Demo…  97.4  54.9 &quot;&quot;    Only… Noth… &quot;&quot;    
##  5  1900   105 AL    5     Demo… Demo…  67.0  77.9 &quot;&quot;    Amat… Noth… &quot;&quot;    
##  6  1900   106 AL    6     Demo… Demo…  65.7  69.8 &quot;&quot;    Amat… Noth… &quot;&quot;    
##  7  1900   107 AL    7     GOP … Demo…  51.8  44.6 &quot;&quot;    Qual… Noth… &quot;&quot;    
##  8  1900   108 AL    8     Demo… Demo…  59.7  84.8 &quot;&quot;    Amat… Noth… &quot;&quot;    
##  9  1900   109 AL    9     Demo… Demo… 100    83.0 &quot;&quot;    No c… Noth… &quot;&quot;    
## 10  1900   401 AR    1     Demo… Demo…  72.4  84.6 &quot;&quot;    Amat… Noth… &quot;&quot;    
## # … with 25,357 more rows, and 3 more variables: dexp &lt;dbl&gt;, rexp &lt;dbl&gt;,
## #   dpres &lt;dbl&gt;</code></pre>
<pre class="r"><code>ggplot(subset(house,house$year %in% 2016),aes(x=dpres,y=dv)) + geom_point(shape=1) + geom_smooth(method=&#39;lm&#39;,SE=T,color=&quot;black&quot;) + theme_bw() + scale_x_continuous(&quot;District Two-Party Vote Share Won by the Democratic Presidential Candidate&quot;) + scale_y_continuous(&quot;District Two-Party Vote Share Won \nby the Democratic House Candidate&quot;) + ggtitle(&quot;Scatterplot of Democratic House Vote-Share by \nDemocratic Presidential Vote-Share in 2016&quot;)</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Sometimes you want to add labels to the point scatters, so you can gain more information about outliers. Thus, let’s recreate the scatter plot with district labels and colors for partisan control before the election.</p>
<pre class="r"><code>house$dem_seat &lt;- ifelse(house$inc == &quot;Dem Incum v. Dem Challenger&quot;,1,ifelse(house$inc == &quot;Democratic Incumbent&quot;,1,ifelse(house$inc == &quot;Democratic Open Seat&quot;,1,ifelse(house$inc == &quot;Two Democrats, open seat&quot;,1,0))))
house$dem_seat &lt;- factor(house$dem_seat,levels=c(0,1),labels=c(&quot;GOP Seat&quot;,&quot;Democratic Seat&quot;))

house$district &lt;- paste(house$state,house$cd,sep=&quot;&quot;)

ggplot(subset(house,house$year %in% 2016),aes(x=dpres,y=dv,color=dem_seat,label=district)) + geom_text(size=2) + geom_smooth(method=&#39;lm&#39;,SE=T,color=&quot;black&quot;) + theme_bw() + scale_color_manual(&quot;Seat Partisanship&quot;,values=c(&quot;red&quot;,&quot;blue&quot;)) + scale_x_continuous(&quot;District Two-Party Vote Share Won by the Democratic Presidential Candidate&quot;,breaks=seq(0,100,10)) + scale_y_continuous(&quot;District Two-Party Vote Share Won \nby the Democratic House Candidate&quot;,breaks=seq(0,100,10)) + ggtitle(&quot;Scatterplot of Democratic House Vote-Share by \nDemocratic Presidential Vote-Share&quot;)  + geom_hline(yintercept = 50, colour = gray(1/2), lty = 2) + theme(legend.position=&quot;bottom&quot;)</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>What if I was interested in looking at multiple election cycles of interest? Looks look at the pivotal elections of 1974, 1994, 2006, and 2010. Let’s take a look!</p>
<pre class="r"><code>ggplot(subset(house,house$year %in% c(1974, 1994,2006,2010)),aes(x=dpres,y=dv,color=dem_seat,label=district)) + geom_point(shape=1) + geom_smooth(method=&#39;lm&#39;,SE=T,color=&quot;black&quot;) + theme_minimal() + scale_color_manual(&quot;Seat Partisanship&quot;,values=c(&quot;red&quot;,&quot;blue&quot;)) + scale_x_continuous(&quot;District Two-Party Vote Share Won by the Democratic Presidential Candidate&quot;,breaks=seq(0,100,10)) + scale_y_continuous(&quot;District Two-Party Vote Share Won \nby the Democratic House Candidate&quot;,breaks=seq(0,100,25)) + ggtitle(&quot;Scatterplot of Democratic House Vote-Share by \nDemocratic Presidential Vote-Share&quot;)  + geom_hline(yintercept = 50, colour = gray(1/2), lty = 2) + theme(legend.position=&quot;bottom&quot;) + facet_wrap(~year,ncol=2) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank()) # The last part of the code takes out all gridlines.</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>In the next section, we will explore how to articulate the results of a simple analysis of variance. For this, we will evaluate the nature of differential item functioning (DIF) in citizen perceptions of political candidates and parties. The problem of DIF can be illustrated in the following example in which the ideological placement of the Democratic party might vary by the ideological perception of a survey respondent. For example, a conserative respondent may place the Democrats on the far-left of the scale (at a 1 on the standard liberal-conservative 7 point scale) while a liberal respondent may place the Democrats more towards the center of the scale (at a 3 or so on the standard liberal-conservative scale). While methods, such as Aldrich-McKelvey scaling, corrects for this measurement error and estimates ``true’’ ideological positions of political stimului (see <a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/ajps.12151">Hare et al. 2016</a> for further details on this estimation), it is important to empirically atriculate the problem.</p>
<p>For this, we turn to the 2016 <a href="https://cces.gov.harvard.edu">Cooperative Congressional Election Study</a> to see if DIF manifests itself in the mass public.</p>
<pre class="r"><code>cces &lt;- read.dta13(&quot;/Users/caalgara/Dropbox/CCES2016_UCD_original/common/CCES2016.dta&quot;,convert.factors = F)
cces &lt;- subset(cces,select=c(&quot;CC16_340a&quot;,&quot;CC16_340d&quot;,&quot;CC16_340e&quot;))
colnames(cces) &lt;- c(&quot;self_placement&quot;,&quot;hrc_placement&quot;,&quot;dt_placement&quot;)

as_tibble(cces)</code></pre>
<pre><code>## # A tibble: 64,600 x 3
##    self_placement hrc_placement dt_placement
##             &lt;int&gt;         &lt;int&gt;        &lt;int&gt;
##  1              3             1            7
##  2              4             1            5
##  3              7             7            1
##  4              5             7            4
##  5              3             2            6
##  6              8             8            8
##  7              7             2            6
##  8              4             4            1
##  9              6             1            5
## 10              5             1            6
## # … with 64,590 more rows</code></pre>
<pre class="r"><code>cces[cces == 8] &lt;- NA # Recode 8, the missing code, to missing
cces &lt;- na.omit(cces)

sample_means &lt;- ddply(cces, .(self_placement), summarize, hrc_sd = sd(hrc_placement,na.rm=T), dt_sd = sd(dt_placement,na.rm=T),hrc_placement = mean(hrc_placement, na.rm = T), dt_placement = mean(dt_placement, na.rm = T))

z_critical_value &lt;- qnorm(0.975)

x &lt;- data.frame(table(cces$self_placement)) # Retrieve Ns

sample_means$self_placement_n &lt;- x[,2]

sample_means$margin_of_error_hrc &lt;- z_critical_value * (sample_means$hrc_sd / sqrt(sample_means$self_placement_n)) # Get margin of error for HRC

sample_means$margin_of_error_dt &lt;- z_critical_value * (sample_means$dt_sd / sqrt(sample_means$self_placement_n)) # Get margin of error for DT

sample_means$hrc_lower_ci &lt;- sample_means$hrc_placement - sample_means$margin_of_error_hrc
sample_means$hrc_upper_ci &lt;- sample_means$hrc_placement + sample_means$margin_of_error_hrc

sample_means$dt_lower_ci &lt;- sample_means$dt_placement - sample_means$margin_of_error_dt
sample_means$dt_upper_ci &lt;- sample_means$dt_placement + sample_means$margin_of_error_dt

# Let&#39;s rework our dataframe to get Trump and Clinton on the same plot

colnames(sample_means)</code></pre>
<pre><code>##  [1] &quot;self_placement&quot;      &quot;hrc_sd&quot;              &quot;dt_sd&quot;              
##  [4] &quot;hrc_placement&quot;       &quot;dt_placement&quot;        &quot;self_placement_n&quot;   
##  [7] &quot;margin_of_error_hrc&quot; &quot;margin_of_error_dt&quot;  &quot;hrc_lower_ci&quot;       
## [10] &quot;hrc_upper_ci&quot;        &quot;dt_lower_ci&quot;         &quot;dt_upper_ci&quot;</code></pre>
<pre class="r"><code>hrc &lt;- sample_means[,c(1,4,9,10)]
dt &lt;- sample_means[,c(1,5,11,12)]

colnames(hrc) &lt;- c(&quot;self_placement&quot;,&quot;mean&quot;,&quot;lower&quot;,&quot;upper&quot;)
colnames(dt) &lt;- c(&quot;self_placement&quot;,&quot;mean&quot;,&quot;lower&quot;,&quot;upper&quot;)

hrc$candidate &lt;- &quot;Hillary Clinton&quot;
dt$candidate &lt;- &quot;Donald Trump&quot;

sample_means &lt;- rbind(hrc,dt)

ggplot(sample_means,aes(x=self_placement,y=mean,ymin=lower,ymax=upper,color=candidate)) + geom_pointrange() + scale_color_manual(&quot;2016 Presidential Candidate&quot;,values=c(&quot;red&quot;,&quot;blue&quot;)) +  theme_minimal() + scale_x_continuous(&quot;Respondent Liberal-Conservative Self-Placement&quot;,breaks=seq(1,7,1)) + scale_y_continuous(&quot;Mean Ideological Placement of Hillary Clinton&quot;) + ggtitle(&quot;Evaluating Differential Item Function in Citizen Ideological Placement \nof the 2016 Presidential Candidates&quot;) + theme(legend.position=&quot;bottom&quot;)</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>It’s hard to see the confidence intervals! Let’s do the candidates on by one to see the DIF up-close.</p>
<pre class="r"><code>ggplot(subset(sample_means,sample_means$candidate == &quot;Hillary Clinton&quot;),aes(x=self_placement,y=mean,ymin=lower,ymax=upper)) + geom_pointrange() +  theme_minimal() + scale_x_continuous(&quot;Respondent Liberal-Conservative Self-Placement&quot;,breaks=seq(1,7,1)) + scale_y_continuous(&quot;Mean Ideological Placement of Hillary Clinton&quot;) + ggtitle(&quot;Evaluating Differential Item Function in Citizen Ideological Placement \nof Hillary Clinton, 2016 CCES&quot;)</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<pre class="r"><code>ggplot(subset(sample_means,sample_means$candidate == &quot;Donald Trump&quot;),aes(x=self_placement,y=mean,ymin=lower,ymax=upper)) + geom_pointrange() +  theme_minimal() + scale_x_continuous(&quot;Respondent Liberal-Conservative Self-Placement&quot;,breaks=seq(1,7,1)) + scale_y_continuous(&quot;Mean Ideological Placement of Donald Trump&quot;) + ggtitle(&quot;Evaluating Differential Item Function in Citizen Ideological Placement \nof Donald Trump, 2016 CCES&quot;)</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/unnamed-chunk-11-2.png" width="672" /></p>
<p>Strong evidence for differential item functioning across respondent liberal-conservative self-placement! This would necessitate the need for method of correctinf for this distortion in left-right scale perceptions.</p>
</div>
<div id="plotting-model-quantities-of-interest" class="section level2">
<h2><em>Plotting Model Quantities of Interest</em></h2>
<p>In this section, we turn to post-estimating model quantitites of interest. First, let’s explore estimating average marginal effects from a simple regression model. We return to our House dataset and specify a pooled vote-share model of House elections from 1900-2016.</p>
<pre class="r"><code>as_tibble(house_elexs)</code></pre>
<pre><code>## # A tibble: 25,367 x 8
##     year district    dv dpres dem_seat dem_incumbency dem_qual_advantage_…   dvp
##    &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;          &lt;dbl&gt;                &lt;dbl&gt; &lt;dbl&gt;
##  1  1900 AL1       82.7  70.1        1              1                    1 100  
##  2  1900 AL2       98.3  65.7       NA              0                   NA  83.3
##  3  1900 AL3       80.2  70.8        1              1                    1  96.9
##  4  1900 AL4       97.4  63.4       NA              0                   NA  54.9
##  5  1900 AL5       67.0  59.7       NA              0                   NA  77.9
##  6  1900 AL6       65.7  59.9        1              1                    1  69.8
##  7  1900 AL7       51.8  45.9        0             -1                    0  44.6
##  8  1900 AL8       59.7  55.2        1              1                    1  84.8
##  9  1900 AL9       NA    62.5        1              1                   NA  83.0
## 10  1900 AR1       72.4  67.2        1              1                    1  84.6
## # … with 25,357 more rows</code></pre>
<pre class="r"><code>library(margins) # Load Thomas Leeper&#39;s Margins Package

summary(model &lt;- glm(dv ~ dem_incumbency + dpres + dem_qual_advantage_tri + dem_seat + dvp, data=house_elexs)) # Estimate our pooled model</code></pre>
<pre><code>## 
## Call:
## glm(formula = dv ~ dem_incumbency + dpres + dem_qual_advantage_tri + 
##     dem_seat + dvp, data = house_elexs)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -37.895   -5.219   -0.033    5.093   37.075  
## 
## Coefficients:
##                        Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)            23.86608    0.34826  68.529   &lt;2e-16 ***
## dem_incumbency          3.58836    0.25083  14.306   &lt;2e-16 ***
## dpres                   0.25333    0.00514  49.283   &lt;2e-16 ***
## dem_qual_advantage_tri  4.87439    0.14175  34.386   &lt;2e-16 ***
## dem_seat               -1.02107    0.51743  -1.973   0.0485 *  
## dvp                     0.30679    0.00474  64.722   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 64.17284)
## 
##     Null deviance: 5033015  on 17251  degrees of freedom
## Residual deviance: 1106725  on 17246  degrees of freedom
##   (8115 observations deleted due to missingness)
## AIC: 120763
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<pre class="r"><code>mes &lt;- data.frame(summary(margins(model, change=&quot;dydx&quot;, vcov.=vcovHC(model, &quot;HC3&quot;))))</code></pre>
<p>Leeper’s <a href="https://github.com/leeper/margins">“margins”</a> command allows us to look at the average marginal effect of our covariates, in this case incumbency (<span class="math inline">\(\texttt{dem_incumbency}\)</span>), district partisanship (<span class="math inline">\(\texttt{dpres}\)</span>), candidate quality ((<span class="math inline">\(\texttt{dem_qual_advantage_tri}\)</span>)), seat partisanship (<span class="math inline">\(\texttt{dem_seat}\)</span>), and previous district election vote share (<span class="math inline">\(\texttt{dem_seat}\)</span>). Let’s use <span class="math inline">\(\texttt{ggplot}\)</span> to create a nice coefficient plot articulating average marginal effects of our key variables.</p>
<pre class="r"><code>head(mes)</code></pre>
<pre><code>##                   factor        AME          SE         z             p
## 1         dem_incumbency  3.5883609 0.250843172 14.305197  2.030632e-46
## 2 dem_qual_advantage_tri  4.8743943 0.141756967 34.385571 4.143372e-259
## 3               dem_seat -1.0210655 0.517397022 -1.973466  4.844247e-02
## 4                  dpres  0.2533264 0.005140253 49.282871  0.000000e+00
## 5                    dvp  0.3067922 0.004740174 64.721719  0.000000e+00
##        lower        upper
## 1  3.0967173  4.080004475
## 2  4.5965557  5.152232844
## 3 -2.0351451 -0.006986002
## 4  0.2432517  0.263401143
## 5  0.2975017  0.316082809</code></pre>
<pre class="r"><code>mes$factor &lt;- ifelse(mes$factor == &quot;dem_incumbency&quot;,&quot;Incumbency&quot;,ifelse(mes$factor == &quot;dem_qual_advantage_tri&quot;,&quot;Candidate Quality&quot;,ifelse(mes$factor == &quot;dem_seat&quot;,&quot;Seat Partisanship&quot;,ifelse(mes$factor == &quot;dpres&quot;,&quot;District Partisanship&quot;,ifelse(mes$factor == &quot;dvp&quot;,&quot;Previous District Dem Vote-Share&quot;,NA)))))

mes$factor &lt;- factor(mes$factor)

ggplot(mes,aes(x=factor,y=AME,ymin=lower,ymax=upper,group=factor,shape=factor)) + theme_minimal() + geom_errorbar(width=0.2,size=1) + geom_point(size=3, fill=&quot;white&quot;,position= position_dodge(width=1.0)) + scale_x_discrete(&quot;&quot;) + scale_shape_manual(&quot;&quot;,values=c(21,21,21,21,21)) + theme(legend.position=&quot;none&quot;) + coord_flip() + geom_hline(yintercept = 0, colour = gray(1/2), lty = 2) + scale_y_continuous(&quot;Average Marginal Effect&quot;) + ggtitle(&quot;Average Marginal Effect of Model Covarates on House Election Vote Shares&quot;)</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>Of course, election dynamics have changed over time and it may be inapproriate to specify a pooled model. Some work argues that the effect of incumbency and state partisanship, in particular, on House election outcomes have varied as elections move from candidate-centered to partisan-centered contexts. Let’s estimate our model yearly to explore these two specific dynamics, incumbency and state partisanship, and how they vary over time.</p>
<pre class="r"><code>mes_yearly &lt;- list()
for(i in seq(1900,2016,2)){
  x &lt;- subset(house,house$year == i)
model &lt;- glm(dv ~ dem_incumbency + dpres + dem_qual_advantage_tri + dem_seat + dvp, data=x) # Estimate our yearly model
mes &lt;- data.frame(summary(margins(model, change=&quot;dydx&quot;, vcov.=vcovHC(x, &quot;HC3&quot;))))
mes$election_year &lt;- i
mes_yearly[[i]] &lt;- mes
}

mes_yearly &lt;- ldply(mes_yearly,data.frame) # Unpack the list

head(mes_yearly)</code></pre>
<pre><code>##                   factor          AME         SE            z            p
## 1         dem_incumbency  1.501725236 1.26763582  1.184666146 2.361495e-01
## 2 dem_qual_advantage_tri  2.297765264 0.85224960  2.696117725 7.015287e-03
## 3               dem_seat -2.367765474 2.80955169 -0.842755620 3.993651e-01
## 4                  dpres  0.450783378 0.04800085  9.391154388 5.934621e-21
## 5                    dvp  0.456198360 0.04821108  9.462520724 3.006075e-21
## 6         dem_incumbency -0.005740137 2.36512318 -0.002426993 9.980635e-01
##        lower     upper election_year
## 1 -0.9827953 3.9862458          1900
## 2  0.6273867 3.9681438          1900
## 3 -7.8743856 3.1388546          1900
## 4  0.3567034 0.5448633          1900
## 5  0.3617064 0.5506903          1900
## 6 -4.6412964 4.6298161          1902</code></pre>
<pre class="r"><code>mes_yearly$factor &lt;- ifelse(mes_yearly$factor == &quot;dem_incumbency&quot;, &quot;Incumbency Advantage&quot;,ifelse(mes_yearly$factor == &quot;dpres&quot;, &quot;District Partisanship&quot;,mes_yearly$factor))

ggplot(subset(mes_yearly,mes_yearly$factor %in% c(&quot;Incumbency Advantage&quot;)),aes(x=election_year,y=AME,ymin=lower,ymax=upper)) + geom_pointrange() + theme_minimal() + ggtitle(&quot;Effect of Incumbency on House Election Outcomes from 1900-2016&quot;) + scale_x_continuous(&quot;&quot;,breaks=seq(1900,2016,10)) + geom_smooth(method=&quot;loess&quot;) + geom_hline(yintercept = 0, colour = gray(1/2), lty = 2)</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<pre class="r"><code>ggplot(subset(mes_yearly,mes_yearly$factor %in% c(&quot;District Partisanship&quot;)),aes(x=election_year,y=AME,ymin=lower,ymax=upper)) + geom_pointrange() + theme_minimal() + ggtitle(&quot;Effect of District Partisanship on House Election Outcomes from 1900-2016&quot;) + scale_x_continuous(&quot;&quot;,breaks=seq(1900,2016,10)) + geom_smooth(method=&quot;loess&quot;) + geom_hline(yintercept = 0, colour = gray(1/2), lty = 2)</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/unnamed-chunk-15-2.png" width="672" /></p>
<p>Now let’s turn to logits! Let’s extract some predicted probabilities! For this example, we turn to investigating the relationship between income, education, and the probability of turning out to vote using data from the 2014 Cooperative Congressional Election Study.</p>
<pre class="r"><code>as_tibble(resources)</code></pre>
<pre><code>## # A tibble: 56,200 x 6
##    weight cdid  turnout contribute income education           
##     &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt;               
##  1  1.61  4           0          0      1 High school graduate
##  2  0.430 6          NA          0     NA High school graduate
##  3  0.819 7           0          0      0 High school graduate
##  4  0.281 3          NA         NA      1 No HS               
##  5  1.34  31         NA          0      8 2-year              
##  6  0.927 9          NA         NA      8 Some college        
##  7  0.379 4           0          0      8 Post-grad           
##  8  0.635 13         NA         NA      7 2-year              
##  9  2.11  20         NA         NA     NA High school graduate
## 10  0.308 8           1          1     10 Post-grad           
## # … with 56,190 more rows</code></pre>
<pre class="r"><code># Turnout ~ Education

model &lt;- glm(turnout ~ education, data=resources, weights=weight, family = binomial(link = &quot;logit&quot;))
predict &lt;- data.frame(effect(&quot;education&quot;, se=TRUE, mod = model, confidence.level = 0.95, xlevels=list(vcov. = cluster.vcov(model, cluster=resources$cdid))))

predict$education &lt;- factor(predict$education,levels=c(&quot;No HS&quot;,&quot;High school graduate&quot;,&quot;Some college&quot;,&quot;2-year&quot;,&quot;4-year&quot;,&quot;Post-grad&quot;))

ggplot(data= predict, mapping=aes(x=education, y=fit, fill=education)) + geom_bar(stat=&quot;identity&quot;) + geom_errorbar(data=predict,aes(ymin=lower,ymax=upper),width=.25) + theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_x_discrete(&quot;Voter Education Level&quot;) + scale_y_continuous(limits=c(0,1.0), breaks=seq(0,1.0,0.05), &quot;Probability of Turning Out to Vote&quot;) + ggtitle(&quot;Probability of Voter Turnout by Education Level in the 2014 Midterm Elections&quot;) + coord_cartesian(ylim=c(0.70,1.0)) + scale_fill_discrete(guide=FALSE)</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<pre class="r"><code># Turnout ~ Income

model &lt;- glm(turnout ~ income, data=resources, weights=weight, family = binomial(link = &quot;logit&quot;))
predict &lt;- data.frame(effect(&quot;income&quot;, se=TRUE, mod = model, confidence.level = 0.95, xlevels=list(income = seq(0,15,1), (vcov. = cluster.vcov(model, cluster=resources$cdid)))))

ggplot(data= predict, mapping=aes(x=income, y=fit)) + geom_line(aes(x = income, y = fit), size = 0.50) + geom_ribbon(aes(ymin=lower, ymax=upper), alpha = .2) + scale_colour_manual(&quot;&quot;,values=&quot;black&quot;) + scale_fill_manual(&quot;&quot;,values=&quot;grey12&quot;) + theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_x_continuous(limits=c(0,15), breaks=c(0,15), labels=c(&quot;Less than \n$10,000&quot;, &quot;Greater than \n$500,000&quot;), &quot;Voter Income&quot;) + scale_y_continuous(limits=c(0.7,1.0), breaks=seq(0.7,1.0,0.05), &quot;Probability of Turning Out to Vote&quot;) + ggtitle(&quot;Probability of Voter Turnout by Income Level in the 2014 Midterm Elections&quot;)</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/unnamed-chunk-17-2.png" width="672" /></p>
<p>What if we want to specify a logistic regression model positing that the effect of education on turning out to vote is conditioned by income? Let’s explore that in the following code.</p>
<pre class="r"><code>resources$education &lt;- factor(resources$education,levels=c(&quot;No HS&quot;,&quot;High school graduate&quot;,&quot;Some college&quot;,&quot;2-year&quot;,&quot;4-year&quot;,&quot;Post-grad&quot;))

model &lt;- glm(turnout ~ education*income, data=resources, weights=weight, family = binomial(link = &quot;logit&quot;))
predict &lt;- data.frame(effect(&quot;education*income&quot;, se=TRUE, mod = model, confidence.level = 0.95, xlevels=list(income=unique(resources$income),vcov. = cluster.vcov(model, cluster=resources$cdid))))
head(predict)</code></pre>
<pre><code>##              education income       fit          se     lower     upper
## 1                No HS      1 0.6283484 0.011177917 0.6061895 0.6499804
## 2 High school graduate      1 0.7500554 0.006151676 0.7378055 0.7619176
## 3         Some college      1 0.7583516 0.007480371 0.7433891 0.7727085
## 4               2-year      1 0.7905850 0.011210956 0.7677654 0.8117123
## 5               4-year      1 0.8395945 0.008915404 0.8213420 0.8563085
## 6            Post-grad      1 0.8769348 0.013904029 0.8469924 0.9016978</code></pre>
<pre class="r"><code>predict$education &lt;- factor(predict$education,levels=c(&quot;No HS&quot;,&quot;High school graduate&quot;,&quot;Some college&quot;,&quot;2-year&quot;,&quot;4-year&quot;,&quot;Post-grad&quot;))

ggplot(predict, aes(x=income, y=fit, group=education,fill=education,linetype=education)) + geom_line(aes(x = income, y = fit), size = 0.50) + geom_ribbon(aes(ymin=lower, ymax=upper), alpha = .2) + theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_x_continuous(limits=c(0,15), breaks=c(0,15), labels=c(&quot;Less than \n$10,000&quot;, &quot;Greater than \n$500,000&quot;), &quot;Voter Income&quot;) + scale_y_continuous(limits=c(0.5,1.0), breaks=seq(0.5,1.0,0.05), &quot;Probability of Turning Out to Vote&quot;) + ggtitle(&quot;Probability of Voter Turnout by Income &amp; Education Level in the 2014 \nMidterm Elections&quot;) + theme(legend.position=&quot;bottom&quot;, legend.box.just = &quot;left&quot;, legend.key.size = unit(1,&quot;line&quot;), legend.key = element_rect(size = 0, color = &#39;white&#39;), legend.text.align = 0, legend.box = &quot;horizontal&quot;) + scale_fill_discrete(&quot;&quot;) + scale_linetype_discrete(&quot;&quot;)</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Among those with no HS diploma, income has a pronounced positive effect on the probability of turning out to vote. For the other education categories, not so much, especially among those with a post-grad. We can also use the code to estimate predicted probabilities for models with categorical dependent variables. Let’s explore this by specifying a multinomial logistic regression evaluating the effect of social network poltiical disagreement on a citizen’s approval evaluation of President Barack Obama in 2016. For this analysis, we will use data from the 2016 UCD &amp; UGA modeul.</p>
<pre class="r"><code>library(nnet)
summary(model &lt;- multinom(pres_approve_clean_factor ~ dem_pid3 + hetero, data=cces, weights=weight, hess=T))</code></pre>
<pre><code>## # weights:  16 (9 variable)
## initial  value 1815.946406 
## iter  10 value 1210.995962
## iter  20 value 1169.712829
## iter  20 value 1169.712827
## final  value 1169.712827 
## converged</code></pre>
<pre><code>## Call:
## multinom(formula = pres_approve_clean_factor ~ dem_pid3 + hetero, 
##     data = cces, weights = weight, hess = T)
## 
## Coefficients:
##                     (Intercept)  dem_pid3    hetero
## Somewhat disapprove  -0.3887573 0.9131467 0.6499331
## Somewhat approve     -0.5009366 2.0588699 1.0057375
## Strongly approve     -0.8641273 2.7485631 1.3663038
## 
## Std. Errors:
##                     (Intercept)  dem_pid3    hetero
## Somewhat disapprove   0.1142644 0.1367009 0.1573080
## Somewhat approve      0.1289659 0.1573176 0.1694963
## Strongly approve      0.1690699 0.1971818 0.1754176
## 
## Residual Deviance: 2339.426 
## AIC: 2357.426</code></pre>
<pre class="r"><code>predict &lt;- effect(&quot;hetero&quot;, se=TRUE, mod = model, confidence.level = 0.95, xlevels=list(hetero=c(-1,-0.6666667,-0.5000000,-0.3333333,0.0000000,0.3333333,0.5000000,0.6666667,1.0000000)))
predict &lt;- data.frame(predict)

# Reshape Probabilities

fit &lt;- predict[,1:5]
lower &lt;- predict[,c(1,18:21)]
upper &lt;- predict[,c(1,22:25)]

colnames(fit) &lt;- c(&quot;hetero&quot;,&quot;fit.Strongly Disapprove&quot;,&quot;fit.Somewhat Disapprove&quot;,&quot;fit.Somewhat Approve&quot;,&quot;fit.Strongly Approve&quot;)
fit &lt;- reshape(fit,idvar=&quot;hetero&quot;,varying=c(&quot;fit.Strongly Disapprove&quot;,&quot;fit.Somewhat Disapprove&quot;,&quot;fit.Somewhat Approve&quot;,&quot;fit.Strongly Approve&quot;),se=&quot;.&quot;,timevar=&quot;approval&quot;,times=c(&quot;Strongly Disapprove&quot;,&quot;Somewhat Disapprove&quot;,&quot;Somewhat Approve&quot;,&quot;Strongly Approve&quot;),direction=&quot;long&quot;)

colnames(lower) &lt;- c(&quot;hetero&quot;,&quot;lower.Strongly Disapprove&quot;,&quot;lower.Somewhat Disapprove&quot;,&quot;lower.Somewhat Approve&quot;,&quot;lower.Strongly Approve&quot;)
lower &lt;- reshape(lower,idvar=&quot;hetero&quot;,varying=c(&quot;lower.Strongly Disapprove&quot;,&quot;lower.Somewhat Disapprove&quot;,&quot;lower.Somewhat Approve&quot;,&quot;lower.Strongly Approve&quot;),se=&quot;.&quot;,timevar=&quot;approval&quot;,times=c(&quot;Strongly Disapprove&quot;,&quot;Somewhat Disapprove&quot;,&quot;Somewhat Approve&quot;,&quot;Strongly Approve&quot;),direction=&quot;long&quot;)

colnames(upper) &lt;- c(&quot;hetero&quot;,&quot;upper.Strongly Disapprove&quot;,&quot;upper.Somewhat Disapprove&quot;,&quot;upper.Somewhat Approve&quot;,&quot;upper.Strongly Approve&quot;)
upper &lt;- reshape(upper,idvar=&quot;hetero&quot;,varying=c(&quot;upper.Strongly Disapprove&quot;,&quot;upper.Somewhat Disapprove&quot;,&quot;upper.Somewhat Approve&quot;,&quot;upper.Strongly Approve&quot;),se=&quot;.&quot;,timevar=&quot;approval&quot;,times=c(&quot;Strongly Disapprove&quot;,&quot;Somewhat Disapprove&quot;,&quot;Somewhat Approve&quot;,&quot;Strongly Approve&quot;),direction=&quot;long&quot;)

predict &lt;- merge(fit,upper,by=c(&quot;hetero&quot;,&quot;approval&quot;))
predict &lt;- merge(predict,lower,by=c(&quot;hetero&quot;,&quot;approval&quot;))

predict$approval &lt;- factor(predict$approval,levels=c(&quot;Strongly Disapprove&quot;,&quot;Somewhat Disapprove&quot;,&quot;Somewhat Approve&quot;,&quot;Strongly Approve&quot;))

ggplot(data= predict, mapping=aes(x=hetero, y=fit)) + geom_line(aes(x = hetero, y = fit), size = 0.50) + geom_ribbon(aes(ymin=lower, ymax=upper), alpha = .2) + scale_colour_manual(&quot;&quot;,values=&quot;black&quot;) + scale_fill_manual(&quot;&quot;,values=&quot;grey12&quot;) + theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_x_continuous(limits=c(-1,1), breaks=c(-1,0,1), labels=c(&quot;GOP&quot;, &quot;Neutral&quot;,&quot;Dem&quot;), &quot;Partisan Network Homogenity&quot;) + scale_y_continuous(limits=c(0,0.70), breaks=seq(0,0.70,0.10), &quot;Predicted Probability of Presidential Approval&quot;) + geom_rug(data=cces, aes(x=hetero, y=1),color = &quot;gray30&quot;, alpha=.5, size = 0.25, position=&#39;jitter&#39;) + ggtitle(&quot;Probability of Approving of President Obama by Partisan Network Homogenity&quot;) + facet_wrap(~approval, ncol = 2, scales = &quot;free_y&quot;) </code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>The results of the multinomial logit model are stirking. After accounting for a respondent’s partisanship, being in a social network full of Democrats lowers the probability of disapproving of Obama relative to all other categories of approval. Moreover, being in a political social network full of Democrats increases the probability of approval relative to all other categories of approval. This is one way in which you can specify a multinomial logit, extract the estimates, and use <span class="math inline">\(\texttt{ggplot}\)</span> to articulate the results.</p>
</div>
<div id="short-introduction-into-ggplot-add-ons-for-plotting-maps-networks" class="section level2">
<h2><em>Short Introduction into ggplot add-ons for plotting Maps &amp; Networks</em></h2>
<p>We can also use <span class="math inline">\(\texttt{ggplot}\)</span> to make nice maps and convey the structure of social networks. Let’s start with making a map of 2016 presidential approval by state. These data are dynamic MRP estimates derived from the 2016 CCES sample. For more information on how to estimate group-level political attitudes using dynamic MRP model estimation, see <a href="http://caughey.mit.edu/sites/default/files/documents/CaugheyWarshaw_DIRT140803.pdf">Caughey &amp; Warshaw 2015</a>.</p>
<p>For this exercise, we need to load a shapefile into R.</p>
<pre class="r"><code># Load the shapefile that has the data to plot maps in ggplot!
# Let&#39;s play around with mapping

# Load the shapefile that has the data to plot maps in ggplot!

library(rgdal)

state_shp &lt;- readOGR(&quot;/Users/caalgara/Desktop/carlos_school/PhD_UC Davis/Research/Data/American Politics/US House_District_Shape_Files/cb_2016_us_state_20m.shp&quot;)</code></pre>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;/Users/caalgara/Desktop/carlos_school/PhD_UC Davis/Research/Data/American Politics/US House_District_Shape_Files/cb_2016_us_state_20m.shp&quot;, layer: &quot;cb_2016_us_state_20m&quot;
## with 52 features
## It has 9 fields
## Integer64 fields read as strings:  ALAND AWATER</code></pre>
<pre class="r"><code># Let&#39;s explore the data embedded in the shape file

as_tibble(state_shp@data) # Dataframe embedded in the Spatial Polygons Data Frame</code></pre>
<pre><code>## # A tibble: 52 x 9
##    STATEFP STATENS  AFFGEOID   GEOID STUSPS NAME         LSAD  ALAND    AWATER  
##    &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   
##  1 23      01779787 0400000US… 23    ME     Maine        00    7988522… 1174875…
##  2 15      01779782 0400000US… 15    HI     Hawaii       00    1663410… 1177769…
##  3 04      01779777 0400000US… 04    AZ     Arizona      00    2941985… 1027346…
##  4 05      00068085 0400000US… 05    AR     Arkansas     00    1347715… 2960191…
##  5 10      01779781 0400000US… 10    DE     Delaware     00    5047194… 1398720…
##  6 13      01705317 0400000US… 13    GA     Georgia      00    1491698… 4741100…
##  7 27      00662849 0400000US… 27    MN     Minnesota    00    2062322… 1892917…
##  8 02      01785533 0400000US… 02    AK     Alaska       00    1477946… 2453904…
##  9 06      01779778 0400000US… 06    CA     California   00    4035011… 2046671…
## 10 11      01702382 0400000US… 11    DC     District of… 00    1583649… 18633403
## # … with 42 more rows</code></pre>
<pre class="r"><code>as_tibble(state_shp@data$NAME) # What type of states are in the file? We don&#39;t want territories!</code></pre>
<pre><code>## # A tibble: 52 x 1
##    value               
##    &lt;chr&gt;               
##  1 Maine               
##  2 Hawaii              
##  3 Arizona             
##  4 Arkansas            
##  5 Delaware            
##  6 Georgia             
##  7 Minnesota           
##  8 Alaska              
##  9 California          
## 10 District of Columbia
## # … with 42 more rows</code></pre>
<pre class="r"><code>state_shp &lt;- subset(state_shp,state_shp@data$NAME != &quot;Puerto Rico&quot;)
state_shp &lt;- subset(state_shp,state_shp@data$NAME != &quot;Alaska&quot;)
state_shp &lt;- subset(state_shp,state_shp@data$NAME != &quot;Hawaii&quot;)
state_shp &lt;- subset(state_shp,state_shp@data$NAME != &quot;District of Columbia&quot;)

# Preliminary look at our map

ggplot(state_shp, aes(x = long, y = lat, group = group)) + geom_polygon(fill = &quot;gray&quot;, color = &quot;black&quot;) + theme_void() + coord_equal() + coord_fixed(1.3)</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>Now that we have successfully loaded our shapefile containing our mapping data into R, let’s merge some state presidential approval data and make a map showing the spatial variation in approval for President Barack Obama in 2016.</p>
<pre class="r"><code>state_pres_approval &lt;- read.dta13(&quot;/Users/caalgara/Desktop/carlos_school/PhD_UC Davis/Dissertation Project/Ch2_Electoral_Implications_Approval/MRP_Estimation/state_presidential_approval_dynamic_mrp_estimates.dta&quot;) # Load the data

as_tibble(state_pres_approval) # Get a glimpse of the data structure. These are Dynamic MRP state-level estimates (see: Caughey &amp; Warshaw (2015) for technical details on the Dynamic MRP model) of presidential approval from 2008-2017. </code></pre>
<pre><code>## # A tibble: 510 x 8
##    param     state  year  mean     sd median q_025 q_975
##    &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 theta_bar AK     2008 0.396 0.0549  0.403 0.309 0.490
##  2 theta_bar AK     2009 0.443 0.0403  0.449 0.376 0.495
##  3 theta_bar AK     2010 0.403 0.0583  0.415 0.314 0.471
##  4 theta_bar AK     2011 0.413 0.0526  0.418 0.329 0.477
##  5 theta_bar AK     2012 0.462 0.0654  0.475 0.365 0.536
##  6 theta_bar AK     2013 0.400 0.0451  0.411 0.330 0.457
##  7 theta_bar AK     2014 0.403 0.0532  0.400 0.324 0.467
##  8 theta_bar AK     2015 0.421 0.0531  0.414 0.334 0.498
##  9 theta_bar AK     2016 0.495 0.0538  0.503 0.411 0.559
## 10 theta_bar AK     2017 0.434 0.0482  0.443 0.368 0.512
## # … with 500 more rows</code></pre>
<pre class="r"><code># Explore map making descriptives. Let&#39;s make a plot of presidential approval for December 2017.

# Make a percentage

state_pres_approval$state_pres_approval_percent &lt;- state_pres_approval$median * 100

as_tibble(state_pres_approval) # Check to see if it worked. Clearly it did!</code></pre>
<pre><code>## # A tibble: 510 x 9
##    param    state  year  mean     sd median q_025 q_975 state_pres_approval_per…
##    &lt;chr&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;                    &lt;dbl&gt;
##  1 theta_b… AK     2008 0.396 0.0549  0.403 0.309 0.490                     40.3
##  2 theta_b… AK     2009 0.443 0.0403  0.449 0.376 0.495                     44.9
##  3 theta_b… AK     2010 0.403 0.0583  0.415 0.314 0.471                     41.5
##  4 theta_b… AK     2011 0.413 0.0526  0.418 0.329 0.477                     41.8
##  5 theta_b… AK     2012 0.462 0.0654  0.475 0.365 0.536                     47.5
##  6 theta_b… AK     2013 0.400 0.0451  0.411 0.330 0.457                     41.1
##  7 theta_b… AK     2014 0.403 0.0532  0.400 0.324 0.467                     40.0
##  8 theta_b… AK     2015 0.421 0.0531  0.414 0.334 0.498                     41.4
##  9 theta_b… AK     2016 0.495 0.0538  0.503 0.411 0.559                     50.3
## 10 theta_b… AK     2017 0.434 0.0482  0.443 0.368 0.512                     44.3
## # … with 500 more rows</code></pre>
<pre class="r"><code>approval_2016 &lt;- subset(state_pres_approval,state_pres_approval$year == 2016) # Subet our data

# Let&#39;s merge our data onto the map!

approval_2016 &lt;- subset(approval_2016,select=c(&quot;state&quot;,&quot;state_pres_approval_percent&quot;))

state_shp@data$id &lt;- rownames(state_shp@data)
state_shp.points &lt;- fortify(state_shp, region=&quot;id&quot;)

state_shp.df &lt;- join(state_shp.points, state_shp@data, by=&quot;id&quot;)
state_shp.df$state &lt;- as.character(state_shp.df$STUSPS)

state_shp.df &lt;- merge(state_shp.df,approval_2016,by=c(&quot;state&quot;))

ggplot(state_shp.df, aes(x = long, y = lat, group = group,fill=state_pres_approval_percent),color=&quot;white&quot;) + geom_polygon(color = &quot;black&quot;) + theme_void() + scale_fill_gradient(&quot;Presidential Approval&quot;,low = &#39;red&#39;, high = &#39;blue&#39;) + ggtitle(&quot;Presidential Approval in the U.S. States, 2016&quot;)  + coord_equal() + coord_fixed(1.3)</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>As one can see, we have some pretty good face validity with our MRP estimates. First, President Obama is popular where you would expect him to be in states such as California, New York, and Vermont. Moreover, he is chronically unpopular where you would expect him to be, in states such as West Virginia and Idaho.</p>
<p>We can also use R to create social network graphs. In the following example, we will visualize the cosponsorship network on programmatic issues in the 113th United States Senate. Let’s explore our data.</p>
<pre class="r"><code>library(network)
library(igraph)
library(ggnet)

as_tibble(x) # This network data is in dyadic form, where each row indicates a pair of Senators.</code></pre>
<pre><code>## # A tibble: 4,802 x 43
##    state_senator_j state_senator_i senator_j senator_i number_cosponso… congress
##    &lt;chr&gt;           &lt;chr&gt;               &lt;int&gt;     &lt;int&gt;            &lt;int&gt;    &lt;int&gt;
##  1 AK              AL                   1898      1548               22      113
##  2 AK              AL                   1898      1049                9      113
##  3 AK              AL                   1694      1548               28      113
##  4 AK              AL                   1694      1049               13      113
##  5 AK              AR                   1898      1687               43      113
##  6 AK              AR                   1694      1701               37      113
##  7 AK              AR                   1898      1701               54      113
##  8 AK              AR                   1694      1687               47      113
##  9 AK              AZ                   1694      1633               22      113
## 10 AK              AZ                   1694       754               27      113
## # … with 4,792 more rows, and 37 more variables: icpsr_id_senator_i &lt;int&gt;,
## #   NameFull_senator_i &lt;chr&gt;, Class_senator_i &lt;int&gt;, Party_senator_i &lt;int&gt;,
## #   ComC_senator_i &lt;int&gt;, ComR_senator_i &lt;int&gt;, DW1_senator_i &lt;dbl&gt;,
## #   Gender_senator_i &lt;int&gt;, Majority_senator_i &lt;int&gt;,
## #   bioguide_id_senator_i &lt;chr&gt;, seniority_num_of_congresses_senator_i &lt;int&gt;,
## #   election_year_senator_i &lt;int&gt;, senator_up_for_relection_senator_i &lt;int&gt;,
## #   icpsr_id_senator_j &lt;int&gt;, NameFull_senator_j &lt;chr&gt;, Class_senator_j &lt;int&gt;,
## #   Party_senator_j &lt;int&gt;, ComC_senator_j &lt;int&gt;, ComR_senator_j &lt;int&gt;,
## #   DW1_senator_j &lt;dbl&gt;, Gender_senator_j &lt;int&gt;, Majority_senator_j &lt;int&gt;,
## #   bioguide_id_senator_j &lt;chr&gt;, seniority_num_of_congresses_senator_j &lt;int&gt;,
## #   election_year_senator_j &lt;int&gt;, senator_up_for_relection_senator_j &lt;int&gt;,
## #   same_committee &lt;int&gt;, same_gender &lt;chr&gt;, same_party &lt;chr&gt;,
## #   same_majority &lt;chr&gt;, same_state_dyad &lt;int&gt;,
## #   number_cosponsored_bills_particularistic &lt;int&gt;, neighbor_adjacency &lt;int&gt;,
## #   centroid_distance &lt;dbl&gt;, centroid_distance_miles &lt;dbl&gt;, co_id &lt;chr&gt;,
## #   edge &lt;dbl&gt;</code></pre>
<pre class="r"><code>adj &lt;- graph.data.frame(x[,c(8,21,43)],directed=T) # Let&#39;s create a network object! What we want to extract is a dataframe where the first column is Senator i, the second column is Senator J, and the last column is a binary variable indicating
adj &lt;- get.adjacency(adj,attr=&#39;edge&#39;,sparse=FALSE) # Convert the edge list to an adjacency matrix
x_ergm &lt;- network(adj, matrix.type = &quot;adjacency&quot;, ignore.eval = FALSE,directed = F,weighted = F,names.eval=&quot;edge&quot;) # Convert the adjacency matrix to a network object

# Now let&#39;s create some attributes and load them on the network object!

y &lt;- x[,c(8,10,2)]
y1 &lt;- x[,c(21,23,1)]
colnames(y) &lt;- c(&quot;NameFull_senator&quot;,&quot;Party_senator&quot;,&quot;State_senator&quot;)
colnames(y1) &lt;- c(&quot;NameFull_senator&quot;,&quot;Party_senator&quot;,&quot;State_senator&quot;)
party &lt;- rbind(y,y1)
rm(y,y1)
party$Party_senator &lt;- ifelse(party$Party_senator == 200, &quot;R&quot;,ifelse(party$Party_senator == 100, &quot;D&quot;,NA))
party &lt;- data.table(party)
party &lt;-  party[, duplicates := 1:.N , by = c(&quot;NameFull_senator&quot;)]
party &lt;- subset(party,party$duplicates == 1)
party &lt;- data.frame(party)
party$duplicates &lt;- NULL
network.vertex.names(x_ergm)</code></pre>
<pre><code>##  [1] &quot;Jefferson Sessions&quot; &quot;Richard Shelby&quot;     &quot;John Boozman&quot;      
##  [4] &quot;Mark Pryor&quot;         &quot;Jeff Flake&quot;         &quot;John McCain&quot;       
##  [7] &quot;Dianne Feinstein&quot;   &quot;Barbara Boxer&quot;      &quot;Michael Bennet&quot;    
## [10] &quot;Mark Udall&quot;         &quot;Richard Blumenthal&quot; &quot;Christopher Murphy&quot;
## [13] &quot;Thomas Carper&quot;      &quot;Chris Coons&quot;        &quot;Marco Rubio&quot;       
## [16] &quot;Bill Nelson&quot;        &quot;John Isakson&quot;       &quot;Saxby Chambliss&quot;   
## [19] &quot;Brian Schatz&quot;       &quot;Mazie Hirono&quot;       &quot;Charles Grassley&quot;  
## [22] &quot;Thomas Harkin&quot;      &quot;James Risch&quot;        &quot;Michael Crapo&quot;     
## [25] &quot;Richard Durbin&quot;     &quot;Mark Kirk&quot;          &quot;Daniel Coats&quot;      
## [28] &quot;Joe Donnelly&quot;       &quot;Jerry Moran&quot;        &quot;Pat Roberts&quot;       
## [31] &quot;Rand Paul&quot;          &quot;Mitch McConnell&quot;    &quot;David Vitter&quot;      
## [34] &quot;Mary Landrieu&quot;      &quot;Elizabeth Warren&quot;   &quot;Benjamin Cardin&quot;   
## [37] &quot;Barbara Mikulski&quot;   &quot;Susan Collins&quot;      &quot;Angus King&quot;        
## [40] &quot;Debbie Stabenow&quot;    &quot;Carl Levin&quot;         &quot;Amy Klobuchar&quot;     
## [43] &quot;Alan Franken&quot;       &quot;Roy Blunt&quot;          &quot;Claire McCaskill&quot;  
## [46] &quot;Thad Cochran&quot;       &quot;Roger Wicker&quot;       &quot;Max Baucus&quot;        
## [49] &quot;Jon Tester&quot;         &quot;Kay Hagan&quot;          &quot;Richard Burr&quot;      
## [52] &quot;John Hoeven&quot;        &quot;Heidi Heitkamp&quot;     &quot;Deb Fischer&quot;       
## [55] &quot;Mike Johanns&quot;       &quot;Jeanne Shaheen&quot;     &quot;Kelly Ayotte&quot;      
## [58] &quot;Robert Menendez&quot;    &quot;Frank Lautenberg&quot;   &quot;Tom Udall&quot;         
## [61] &quot;Martin Heinrich&quot;    &quot;Harry Reid&quot;         &quot;Dean Heller&quot;       
## [64] &quot;Charles Schumer&quot;    &quot;Kirsten Gillibrand&quot; &quot;Robert Portman&quot;    
## [67] &quot;Sherrod Brown&quot;      &quot;Thomas Coburn&quot;      &quot;James Inhofe&quot;      
## [70] &quot;Ron Wyden&quot;          &quot;Jeff Merkley&quot;       &quot;Patrick Toomey&quot;    
## [73] &quot;Robert Casey&quot;       &quot;Sheldon Whitehouse&quot; &quot;John Reed&quot;         
## [76] &quot;Lindsey Graham&quot;     &quot;Tim Scott&quot;          &quot;Tim Johnson&quot;       
## [79] &quot;John Thune&quot;         &quot;Lamar Alexander&quot;    &quot;Bob Corker&quot;        
## [82] &quot;John Cornyn&quot;        &quot;Ted Cruz&quot;           &quot;Orrin Hatch&quot;       
## [85] &quot;Mike Lee&quot;           &quot;Timothy Kaine&quot;      &quot;Mark Warner&quot;       
## [88] &quot;Bernard Sanders&quot;    &quot;Patrick Leahy&quot;      &quot;Maria Cantwell&quot;    
## [91] &quot;Patty Murray&quot;       &quot;Ron Johnson&quot;        &quot;Tammy Baldwin&quot;     
## [94] &quot;John Rockefeller&quot;   &quot;Joe Manchin&quot;        &quot;Michael Enzi&quot;      
## [97] &quot;John Barrasso&quot;      &quot;Mark Begich&quot;        &quot;Lisa Murkowski&quot;</code></pre>
<pre class="r"><code>x_ergm%v%&#39;party&#39;&lt;- party$Party_senator # Merge the party attributes for each Senator!
x_ergm%v%&#39;state&#39;&lt;- party$State_senator # Merge the state attributes for each Senator!
x_ergm%v%&quot;color&quot; = ifelse(x_ergm%v%&quot;party&quot; == &quot;R&quot;, &quot;red&quot;, &quot;blue&quot;) # Create color indicators!</code></pre>
<p>Now, let’s create three network graphs using various labels for our nodes!</p>
<pre class="r"><code>ggnet2(x_ergm, label = &quot;state&quot;, color = &quot;grey15&quot;, label.color = &quot;color&quot;,alpha = 0, size = 0, edge.alpha = 0.5,mode = &quot;kamadakawai&quot;,label.size = 3) + ggtitle(&quot;113th U.S. Senate Particularistic Cosponsorship Network&quot;)</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<pre class="r"><code>ggnet2(x_ergm, label = &quot;vertex.names&quot;, color = &quot;grey15&quot;, label.color = &quot;color&quot;,alpha = 0, size = 0, edge.alpha = 0.5,mode = &quot;kamadakawai&quot;,label.size = 3) + ggtitle(&quot;113th U.S. Senate Particularistic Cosponsorship Network&quot;)</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/unnamed-chunk-25-2.png" width="672" /></p>
<pre class="r"><code>ggnet2(x_ergm, color = &quot;color&quot;, alpha = 0.75, size = 4, edge.alpha = 0.5,vjust = -0.6,mode = &quot;kamadakawai&quot;) + ggtitle(&quot;113th U.S. Senate Particularistic Cosponsorship Network&quot;)</code></pre>
<p><img src="UCD_PS_ggplot_tutorial_files/figure-html/unnamed-chunk-25-3.png" width="672" /></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
